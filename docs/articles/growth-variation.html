<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Growth variation through time • ctfs</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">ctfs</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/forestgeo/ctfs">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Growth variation through time</h1>
            <h3 class="subtitle">Adapted by Mauro Lepore from the original tutorial by Richard Condit (<a href="https://goo.gl/c9RjMY" class="uri">https://goo.gl/c9RjMY</a>)</h3>
            
            <h4 class="date">2017-04-22</h4>
          </div>

    
    
<div class="contents">
<div id="goal" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#goal" class="anchor"> </a></body></html>Goal</h1>
<p>The goal is two fold:</p>
<ul>
<li><p>to show how ctfs functions can help you solve problems that may be relevant to you;</p></li>
<li><p>to show how to explore research questions in a systematic way, using modern programatic tools and style in the tidyverse (xxxinsert link)</p></li>
</ul>
<p>The original version of this tutorial, by Richard Condit, is at <a href="https://goo.gl/c9RjMY" class="uri">https://goo.gl/c9RjMY</a>.</p>
<p>xxx change the focus. Instead of replicating the previous tutorial, use r4ds as a guide to show a generic EDA. This should result in a vignette that is more simple from the analitical viewpoint and more comprehensive from the technical viewpoint. So the audience should be broader, making the vignette more useful than before.</p>
</div>
<div id="the-pipe-operator" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#the-pipe-operator" class="anchor"> </a></body></html>The pipe operator %&gt;%</h1>
<p>xxx what is the best discusison? HW? Jenny Bryan? maggrittr? …</p>
<p>xxx to address an exploratory data analysis systematically see r4ds “exploratory data analysis”</p>
<ul>
<li>first, before any complex summary or model, analyse how interesting variables vary, here, species (categorical) and growth between intervals (continuous).</li>
</ul>
<p>xxx explain why use the pipe. clear writing comes from position (Goepen xxx). Ideas are clearly communicated if information flows from new old to old, and agents are mapped to subjects, and actions to verbs (Style by Strunk or white?). This structure is impossible with traditional programming</p>
<p>unnatural flow of information</p>
<p>Unclear: flows backwards, from actions to agents, and from new to old information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(x)
<span class="kw">action</span>(agent)
<span class="kw">verb</span>(subject)

<span class="co"># minimal semantic example</span>
<span class="kw">eat</span>(I)

<span class="co"># a longer, more realistic example</span>
<span class="kw">sleep</span>(
  <span class="kw">yawn</span>(
    <span class="kw">clean</span>(
      <span class="kw">eat</span>(
        I
      )
    )
  )
)</code></pre></div>
<p>Clear: flows forwards, from agents to actions, and from old to new information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x %&gt;%<span class="st"> </span><span class="kw">sum</span>()
agent %&gt;%<span class="st"> </span><span class="kw">action</span>()
subject %&gt;%<span class="st"> </span><span class="kw">verb</span>()

<span class="co"># minimal semantic example</span>
<span class="kw">eat</span>(I)
I %&gt;%<span class="st"> </span>eat

<span class="co"># a longer, more realistic example</span>
I %&gt;%<span class="st"> </span>
<span class="st">  </span>eat %&gt;%<span class="st"> </span>
<span class="st">  </span>clean %&gt;%<span class="st"> </span>
<span class="st">  </span>yawn %&gt;%<span class="st"> </span>
<span class="st">  </span>sleep</code></pre></div>
</div>
<div id="conventions-to-refer-to-code" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#conventions-to-refer-to-code" class="anchor"> </a></body></html>Conventions to refer to code</h1>
<p>I refer to code following the conventions of <a href="http://r4ds.had.co.nz/introduction.html">R for data science</a>, by Hadley Wickham &amp; Garrett Grolemund:</p>
<blockquote>
<p>Functions are in a code font and followed by parentheses, like <code>sum()</code>, or <code>mean()</code>.</p>
</blockquote>
<blockquote>
<p>Other R objects (like data or function arguments) are in a code font, without parentheses, like <code>flights</code> or <code>x</code>.</p>
</blockquote>
<blockquote>
<p>If we want to make it clear what package an object comes from, weâ€™ll use the package name followed by two colons, like<code>dplyr::mutate()</code>, or <code>nycflights13::flights</code>. This is also valid R code.</p>
</blockquote>
</div>
<div id="hypotheses" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#hypotheses" class="anchor"> </a></body></html>Hypotheses</h1>
<p>The question addressed here is how growth has changed with time, in particular how species differ in growth changes. There are two alternative models described:</p>
<ul>
<li>Growth rate changing linearly with time</li>
<li>Growth rate varying from census to census, but not following a consistent change</li>
</ul>
</div>
<div id="packages" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#packages" class="anchor"> </a></body></html>Packages</h1>
<p>The functions we use here come with the <a href="https://forestgeo.github.io/ctfs/">ctfs</a> and <a href="https://github.com/lme4/lme4/">lme4</a> packages, and the data comes in the <a href="https://forestgeo.github.io/bci/">bci</a> package. To exploratory data easily we can use the tidyverse and modelr package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Links provide installation instructions</span>
<span class="kw">library</span>(ctfs)       <span class="co"># https://github.com/forestgeo/ctfs</span>
<span class="kw">library</span>(lme4)       <span class="co"># https://github.com/lme4/lme4/</span>
<span class="kw">library</span>(bci)        <span class="co"># https://forestgeo.github.io/bci/</span>
<span class="kw">library</span>(tidyverse)  <span class="co"># xxx insert link</span>
<span class="kw">library</span>(modelr)     <span class="co"># xxx insert link</span></code></pre></div>
<p>To access functions commonly used for data analysis, load the tidyverse package:</p>
</div>
<div id="calculate-growth-rates-of-individual-trees-between-census-intervals" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#calculate-growth-rates-of-individual-trees-between-census-intervals" class="anchor"> </a></body></html>1. Calculate growth rates of individual trees between census intervals</h1>
<p>First, let’s table the growth rate of every tree in every census interval. To calculate growth rates for individual trees and table them in the format lmer understands, we use <code>ctfs::individual_grow.table()</code>. <code><a href="../reference/individual_grow.table.html">individual_grow.table()</a></code> collects results from several other functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># See default arguments, definition of output variables and other details with</span>
<span class="co"># ?individual_grow.table</span>

<span class="co"># Example choosing censuses 1-7</span>
census17_chr &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"bci12full"</span>, <span class="dv">1</span>:<span class="dv">7</span>)
census17_list &lt;-<span class="st"> </span><span class="kw">lapply</span>(census17_chr, get)
grate &lt;-<span class="st"> </span><span class="kw"><a href="../reference/individual_grow.table.html">individual_grow.table</a></span>(
  census17_list, 
  <span class="dt">mindbh =</span> <span class="dv">400</span>, <span class="dt">maxdbh =</span> <span class="dv">10000</span>  <span class="co"># e.g. with trees of relatively large diameter</span>
)
<span class="co"># Overview</span>
(grate &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(grate))
<span class="co">#&gt; # A tibble: 8,594 × 14</span>
<span class="co">#&gt;    treeID        tag    gx    gy    species  dbh1  dbh2      LnSize</span>
<span class="co">#&gt; *   &lt;int&gt; &lt;S3: AsIs&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;S3: AsIs&gt; &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1      39     000022 989.1 421.3     anacex  1761  1855  1.12953376</span>
<span class="co">#&gt; 2      59     000044 991.8 342.5     loncla   655   670  0.14053188</span>
<span class="co">#&gt; 3     102     000087 985.6 226.5     anacex   426   533 -0.28966401</span>
<span class="co">#&gt; 4     103     000088 983.7 229.4     tri2tu   553   587 -0.02874535</span>
<span class="co">#&gt; 5     104     000089 988.9 232.8     alsebl   642   661  0.12048495</span>
<span class="co">#&gt; 6     117     000102 994.2 185.3     huracr   732   837  0.25167716</span>
<span class="co">#&gt; 7     126     000111 998.0 167.2     loncla   453   478 -0.22821123</span>
<span class="co">#&gt; 8     129     000114 987.0 151.6     huracr   481   543 -0.16823608</span>
<span class="co">#&gt; 9     131     000116 981.7 141.8     tab2ar   499   525 -0.13149726</span>
<span class="co">#&gt; 10    134     000120 987.4 129.4     cavapl  1413  1384  0.90936703</span>
<span class="co">#&gt; # ... with 8,584 more rows, and 6 more variables: incgr &lt;dbl&gt;,</span>
<span class="co">#&gt; #   LnGrowth &lt;dbl&gt;, CRGrowth &lt;dbl&gt;, time &lt;dbl&gt;, census &lt;int&gt;,</span>
<span class="co">#&gt; #   censusfact &lt;fctr&gt;</span></code></pre></div>
</div>
<div id="summarize-mean-growth-forest-wide" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#summarize-mean-growth-forest-wide" class="anchor"> </a></body></html>2. Summarize mean growth, forest-wide</h1>
<p>Second, for each census period, summarize the data to give the mean growth rate of all individuals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Table summary</span>
growth_smry &lt;-<span class="st"> </span>grate %&gt;%<span class="st"> </span>
<span class="st">  </span>dplyr::<span class="kw">group_by</span>(census) %&gt;%<span class="st"> </span>
<span class="st">  </span>dplyr::<span class="kw">summarize</span>(
    <span class="dt">yr_mean =</span> <span class="kw">mean</span>(time),  <span class="co"># mean years since 1992</span>
    <span class="dt">increment_mean =</span> <span class="kw">mean</span>(incgr),  <span class="co"># mean of untransformed growth increment</span>
    <span class="dt">n =</span> <span class="kw">n</span>()  <span class="co"># count observations</span>
  )
growth_smry
<span class="co">#&gt; # A tibble: 6 × 4</span>
<span class="co">#&gt;   census   yr_mean increment_mean     n</span>
<span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt;          &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1      1 -8.341837      10.280166  1014</span>
<span class="co">#&gt; 2      2 -3.963116       7.510867  1169</span>
<span class="co">#&gt; 3      3  1.207770       4.644751  1592</span>
<span class="co">#&gt; 4      4  6.046461       5.183409  1633</span>
<span class="co">#&gt; 5      5 11.042803       4.777542  1550</span>
<span class="co">#&gt; 6      6 16.079248       5.080532  1636</span>

<span class="co"># Visual summary</span>
growth_smry %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> yr_mean, <span class="dt">y =</span> increment_mean)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="growth-variation_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div id="xxx-maybe-remove" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#xxx-maybe-remove" class="anchor"> </a></body></html>xxx maybe remove</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">by_census_interval &lt;-<span class="st"> </span>dplyr::<span class="kw">group_by</span>(grate, census) 
growth_summary &lt;-<span class="st"> </span>dplyr::<span class="kw">summarize</span>(by_census_interval,
  <span class="dt">yr_mean        =</span> <span class="kw">mean</span>(time),       <span class="co"># mean years since 1992</span>
  <span class="dt">increment_mean =</span> <span class="kw">mean</span>(incgr),      <span class="co"># mean of untransformed growth increment</span>
  <span class="dt">increment_med  =</span> <span class="kw">median</span>(incgr),    <span class="co"># as above but median</span>
  <span class="dt">root_mean      =</span> <span class="kw">mean</span>(CRGrowth),   <span class="co"># mean of cube root of growth rate</span>
  <span class="dt">root_med       =</span> <span class="kw">median</span>(CRGrowth)  <span class="co"># as above but median</span>
)
growth_summary
<span class="co">#&gt; # A tibble: 6 × 6</span>
<span class="co">#&gt;   census   yr_mean increment_mean increment_med root_mean root_med</span>
<span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1      1 -8.341837      10.280166      8.380528  2.456828 2.602987</span>
<span class="co">#&gt; 2      2 -3.963116       7.510867      5.092428  1.991760 2.080253</span>
<span class="co">#&gt; 3      3  1.207770       4.644751      3.349970  1.604515 1.722932</span>
<span class="co">#&gt; 4      4  6.046461       5.183409      3.422960  1.731147 1.739726</span>
<span class="co">#&gt; 5      5 11.042803       4.777542      3.326767  1.650958 1.717547</span>
<span class="co">#&gt; 6      6 16.079248       5.080532      3.644401  1.744470 1.789500</span>
<span class="co"># (To refresh definition of variables in grate run ?individual_grow.table)</span></code></pre></div>
<p>To visualize the growth summary, let’s graph mean growth vs. time. Although you may simply graph the mean growth increment, here I use the mean of the cube-root of growth.</p>
</div>
<div id="mixed-model-to-assess-species-variation-in-linear-changes-through-time" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#mixed-model-to-assess-species-variation-in-linear-changes-through-time" class="anchor"> </a></body></html>3. Mixed model to assess species variation in linear changes through time</h1>
<p>Third, let’s model a linear regression of growth rate vs. time, with species as a random effect. This is equivalent to a hierarchical model, where a Gaussian distribution describes the variation in species responses. As the response variable, we use the cube root of growth. This allows us to come closer to a normal error term while not requiring artificial exclusion of negative growth rates (as a log-tranformation would).</p>
<p>To build the model we can use <code>lme4::lmer()</code> with appropriate formula and data (see <code>?lmer</code>).</p>
<p>An appropriate formula is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myformula &lt;-<span class="st"> </span>incgr ~<span class="st"> </span><span class="dv">1</span> +<span class="st"> </span>time +<span class="st"> </span>(<span class="dv">1</span> +<span class="st"> </span>time |<span class="st"> </span>species)</code></pre></div>
<p>After <code>~</code>, the component “<code>1 + time</code>” means to fit a model of <code>CRGrowth</code> against <code>time</code>, with an intercept (the <code>1</code>). Next, <code>(1 + time | species)</code> means that the intercept and slope should both be allowed to vary across <code>species</code>. Following the same logic, <code>(1 + time | tag)</code> would account for repeated measures of individuals by using the tree <code>tag</code> (identifying individual trees) as a random effect.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mixed_model &lt;-<span class="st"> </span>function(df) {
  <span class="kw">lmer</span>(incgr ~<span class="st"> </span><span class="dv">1</span> +<span class="st"> </span>time +<span class="st"> </span>(<span class="dv">1</span> +<span class="st"> </span>time |<span class="st"> </span>species), <span class="dt">data =</span> df)
}
modlist &lt;-<span class="st"> </span>grate %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">uo3 =</span> <span class="kw">ifelse</span>(census &lt;=<span class="st"> </span><span class="dv">3</span>, <span class="st">"under3"</span>, <span class="st">"over3"</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(uo3) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">nest</span>() %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">models =</span> purrr::<span class="kw"><a href="../reference/map.html">map</a></span>(data, mixed_model))

<span class="co"># extract coefficients</span>
<span class="kw">bind_rows</span>(
  <span class="kw">fixef</span>(modlist$models[[<span class="dv">1</span>]]) %&gt;%<span class="st"> </span><span class="kw">enframe</span>() %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">uo3 =</span> <span class="st">"under3"</span>),
  <span class="kw">fixef</span>(modlist$models[[<span class="dv">1</span>]]) %&gt;%<span class="st"> </span><span class="kw">enframe</span>() %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">uo3 =</span> <span class="st">"over3"</span>)
)
<span class="co">#&gt; # A tibble: 4 × 3</span>
<span class="co">#&gt;          name      value    uo3</span>
<span class="co">#&gt;         &lt;chr&gt;      &lt;dbl&gt;  &lt;chr&gt;</span>
<span class="co">#&gt; 1 (Intercept)  5.7550942 under3</span>
<span class="co">#&gt; 2        time -0.7154974 under3</span>
<span class="co">#&gt; 3 (Intercept)  5.7550942  over3</span>
<span class="co">#&gt; 4        time -0.7154974  over3</span>

<span class="co"># add predictions and residuals to data</span>
<span class="kw">map2</span>(modlist$data, modlist$models, add_predictions) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">map2</span>(modlist$models, add_residuals) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="st">"under3"</span>, <span class="st">"over3"</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">enframe</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">uo3 =</span> name) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="co"># plot predictions and residuals</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(time, pred)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> resid), <span class="dt">colour =</span> <span class="st">"red"</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>)</code></pre></div>
<p><img src="growth-variation_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>The data is more appropriately split in two than used as a whole, so that we can build two models to describe our data. This seems important because the plot above shows that growth rates through time had a different trend before and since the third census (before, they declined; since, they sabilized). So let’s run two separate models, for censuses â‰¤ 3 and censuses â‰¥ 3.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Split data to capture trends before and since 3rd census</span>
dat3_under &lt;-<span class="st"> </span>dplyr::<span class="kw">filter</span>(grate, census &lt;=<span class="st"> </span><span class="dv">3</span>)
dat3_over  &lt;-<span class="st"> </span>dplyr::<span class="kw">filter</span>(grate, census &gt;=<span class="st"> </span><span class="dv">3</span>)

<span class="co"># Apply a model function to each component of the split data set</span>
mymodels &lt;-<span class="st"> </span><span class="kw">lapply</span>(
  <span class="kw">list</span>(<span class="dt">mod3_under =</span> dat3_under, <span class="dt">mod3_over =</span> dat3_over),
  function(x) <span class="kw">lmer</span>(myformula, <span class="dt">data =</span> x)
)
mymodels
<span class="co">#&gt; $mod3_under</span>
<span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span>
<span class="co">#&gt; Formula: incgr ~ 1 + time + (1 + time | species)</span>
<span class="co">#&gt;    Data: x</span>
<span class="co">#&gt; REML criterion at convergence: 25864.86</span>
<span class="co">#&gt; Random effects:</span>
<span class="co">#&gt;  Groups   Name        Std.Dev. Corr </span>
<span class="co">#&gt;  species  (Intercept) 3.5801        </span>
<span class="co">#&gt;           time        0.4733   -0.87</span>
<span class="co">#&gt;  Residual             7.2079        </span>
<span class="co">#&gt; Number of obs: 3775, groups:  species, 108</span>
<span class="co">#&gt; Fixed Effects:</span>
<span class="co">#&gt; (Intercept)         time  </span>
<span class="co">#&gt;      5.7551      -0.7155  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $mod3_over</span>
<span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span>
<span class="co">#&gt; Formula: incgr ~ 1 + time + (1 + time | species)</span>
<span class="co">#&gt;    Data: x</span>
<span class="co">#&gt; REML criterion at convergence: 39270.77</span>
<span class="co">#&gt; Random effects:</span>
<span class="co">#&gt;  Groups   Name        Std.Dev. Corr</span>
<span class="co">#&gt;  species  (Intercept) 3.956625     </span>
<span class="co">#&gt;           time        0.002963 1.00</span>
<span class="co">#&gt;  Residual             5.060651     </span>
<span class="co">#&gt; Number of obs: 6411, groups:  species, 112</span>
<span class="co">#&gt; Fixed Effects:</span>
<span class="co">#&gt; (Intercept)         time  </span>
<span class="co">#&gt;    5.807901     0.005247</span></code></pre></div>
<p>The key result are the coefficients of each model. The fixed effect gives the forest-wide response, which is the average growth of the species. It is thus not the same as the mean forest-wide growth, because the fixed effect weights each species equally.</p>
<p>To do the same in a more convenient way, we can use the tidyverse. This shows how to manipulate the output of multiple models so that it is easier to visualize and to work with later:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Same output as mymodel, but easier to visualize and to work with</span>
<span class="co"># (see the pipe operator "%&gt;%" at http://r4ds.had.co.nz/pipes.html)</span>
tidymodels &lt;-<span class="st"> </span>mymodels %&gt;%<span class="st">  </span><span class="co"># take mymodels, then transform</span>
<span class="st">  </span><span class="kw">lapply</span>(broom::tidy) %&gt;%<span class="st">   </span><span class="co"># from model summmaries to data frames (df), then</span>
<span class="st">  </span>tibble::<span class="kw">enframe</span>() %&gt;%<span class="st">     </span><span class="co"># from named lists of df to single nested df, then</span>
<span class="st">  </span>tidyr::<span class="kw">unnest</span>()           <span class="co"># from nested df to normal df.</span>
tidymodels
<span class="co">#&gt; # A tibble: 12 × 6</span>
<span class="co">#&gt;          name                         term     estimate  std.error</span>
<span class="co">#&gt;         &lt;chr&gt;                        &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1  mod3_under                  (Intercept)  5.755094174 0.42222709</span>
<span class="co">#&gt; 2  mod3_under                         time -0.715497356 0.06355431</span>
<span class="co">#&gt; 3  mod3_under       sd_(Intercept).species  3.580133791         NA</span>
<span class="co">#&gt; 4  mod3_under              sd_time.species  0.473272408         NA</span>
<span class="co">#&gt; 5  mod3_under cor_(Intercept).time.species -0.873486385         NA</span>
<span class="co">#&gt; 6  mod3_under      sd_Observation.Residual  7.207897338         NA</span>
<span class="co">#&gt; 7   mod3_over                  (Intercept)  5.807901217 0.42494908</span>
<span class="co">#&gt; 8   mod3_over                         time  0.005247249 0.01146385</span>
<span class="co">#&gt; 9   mod3_over       sd_(Intercept).species  3.956624741         NA</span>
<span class="co">#&gt; 10  mod3_over              sd_time.species  0.002962972         NA</span>
<span class="co">#&gt; 11  mod3_over cor_(Intercept).time.species  1.000000000         NA</span>
<span class="co">#&gt; 12  mod3_over      sd_Observation.Residual  5.060650926         NA</span>
<span class="co">#&gt; # ... with 2 more variables: statistic &lt;dbl&gt;, group &lt;chr&gt;</span></code></pre></div>
<p>The following graph uses the function fixef to get the parameters, then the function curve to add them to the graph. The points are forest-wide means, as graphed above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidymodels %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(name, term, estimate) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(term %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"time"</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="kw">gsub</span>(<span class="st">"^..ntercept.$"</span>, <span class="st">"intercept"</span>, term)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(term, estimate)
<span class="co">#&gt; # A tibble: 2 × 3</span>
<span class="co">#&gt;         name intercept         time</span>
<span class="co">#&gt; *      &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt;</span>
<span class="co">#&gt; 1  mod3_over  5.807901  0.005247249</span>
<span class="co">#&gt; 2 mod3_under  5.755094 -0.715497356</span>
  

mycoefs &lt;-<span class="st"> </span><span class="kw">lapply</span>(mymodels, fixef)

<span class="kw">ggplot</span>(<span class="dt">data =</span> growth_summary, <span class="kw">aes</span>(<span class="dt">x =</span> yr_mean, <span class="dt">y =</span> root_med)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_abline</span>(
    <span class="dt">slope =</span> mycoefs$mod3_under[<span class="dv">2</span>],
    <span class="dt">intercept =</span> mycoefs$mod3_under[<span class="dv">1</span>]
    ) +
<span class="st">  </span><span class="kw">geom_abline</span>(
    <span class="dt">slope =</span> mycoefs$mod3_over[<span class="dv">2</span>],
    <span class="dt">intercept =</span> mycoefs$mod3_over[<span class="dv">1</span>]
    ) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"years since 1992"</span>, <span class="dt">y =</span> <span class="st">"median growth"</span>)</code></pre></div>
<p><img src="growth-variation_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>xxxcont</p>
<ul>
<li>move faster, focus on models more and on plots less.</li>
<li>review model chapters from r4ds and see what I can use here.</li>
<li>find a better way to do this with modelr</li>
<li>note that the scale of axis y is different from that in vignette</li>
</ul>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#references" class="anchor"> </a></body></html>References</h1>
<p><a href="https://dx.doi.org/10.5479/data.bci.20130603">Repository</a> of the Barro Colorado Forest Census Plot Data (version 2012).</p>
<p><a href="https://repository.si.edu/bitstream/handle/10088/20925/RoutputFull.pdf?sequence=1&amp;isAllowed=y">Description</a> of the Barro Colorado Forest Census Plot Data.</p>
</div>
<div id="todo" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#todo" class="anchor"> </a></body></html>Todo</h1>
<p>MOST IMPORTANT</p>
<ul>
<li>Use data from several censuses in bci</li>
<li>Document missing arguments in <code><a href="../reference/individual_grow.table.html">individual_grow.table()</a></code>
</li>
<li>Document variable names of output in <code><a href="../reference/individual_grow.table.html">individual_grow.table()</a></code>
</li>
</ul>
<p>LESS IMPORTANT</p>
<ul>
<li>track functions called by <code><a href="../reference/individual_grow.table.html">individual_grow.table()</a></code>
</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#goal">Goal</a></li>
      <li><a href="#the-pipe-operator">The pipe operator %&gt;%</a></li>
      <li><a href="#conventions-to-refer-to-code">Conventions to refer to code</a></li>
      <li><a href="#hypotheses">Hypotheses</a></li>
      <li><a href="#packages">Packages</a></li>
      <li><a href="#calculate-growth-rates-of-individual-trees-between-census-intervals">1. Calculate growth rates of individual trees between census intervals</a></li>
      <li><a href="#summarize-mean-growth-forest-wide">2. Summarize mean growth, forest-wide</a></li>
      <li><a href="#xxx-maybe-remove">xxx maybe remove</a></li>
      <li><a href="#mixed-model-to-assess-species-variation-in-linear-changes-through-time">3. Mixed model to assess species variation in linear changes through time</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#todo">Todo</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Richard Condit.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
