<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>A Metropolis MCMC version of lmer. — lmerBayes â€¢ ctfs</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">ctfs</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Functions Index</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/maurolepore">
    <span class="fa fa-gavel"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/forestgeo/ctfs">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://forestgeo.github.io/fgeo/">fgeo</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>A Metropolis MCMC version of lmer.</h1>
    </div>

    
    <p>A Metropolis MCMC version of lmer. A single independent variable, y, can be
fit against any number of predictors, x, with one random effect. Like lmer,
the model error can be binomial or Gaussian, but there are two alternatives
for the Gaussian (described below). Relative to lmer, the key advantage
offered is that y can be any function of the x. A second advantage is that
the MCMC produces posterior distributions on every parameter, so full
confidence limits are available. The principal limitation relative to lmer is
that only one random effect is allowed. In addition, the Bayesian MCMC
approach is quite a bit slower.</p>
    

    <pre class="usage"><span class='fu'>lmerBayes</span>(<span class='no'>data</span>, <span class='no'>ycol</span>, <span class='no'>randcol</span>, <span class='no'>xcol</span>, <span class='no'>start</span>, <span class='kw'>fixef</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>startSD</span>, <span class='no'>startCov</span>,
  <span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>logistic.standard</span>, <span class='kw'>error</span> <span class='kw'>=</span> <span class='st'>"Binom"</span>, <span class='kw'>includeCovar</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>update</span> <span class='kw'>=</span> <span class='st'>"conjugate"</span>, <span class='kw'>badparam</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>sdfunc</span> <span class='kw'>=</span> <span class='no'>constant</span>, <span class='no'>badSDparam</span>,
  <span class='kw'>paramfile</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>savestep</span> <span class='kw'>=</span> <span class='fl'>500</span>, <span class='kw'>steps</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='kw'>showstep</span> <span class='kw'>=</span> <span class='fl'>100</span>,
  <span class='kw'>burnin</span> <span class='kw'>=</span> <span class='fl'>100</span>, <span class='kw'>debug</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>The table of data, in lmer-style, including one column to be
modeled (dependent variable, y), one or more predictors (independent
variables, x), and one random effect, using any column names.</p></td>
    </tr>
    <tr>
      <th>randcol</th>
      <td><p>The name of one column holding the random variable; must be a
character variable.</p></td>
    </tr>
    <tr>
      <th>xcol, ycol</th>
      <td><p>Chareacter string giving the name of a column in `data` that
holds the x and y (numeric) variable.</p></td>
    </tr>
    <tr>
      <th>start</th>
      <td><p>A vector giving the starting set of parameters for the model. It
must be as long as the number of parameters required by the model.</p></td>
    </tr>
    <tr>
      <th>startSD</th>
      <td><p>A single starting value for the residual standard deviation,
only used with Gaussian and Negative Binomial error models.</p></td>
    </tr>
    <tr>
      <th>startCov</th>
      <td><p>Starting values of the diagonal of the covariance matrix;
ignored if a full matrix of start parameters is submitted. Required even if
covariance matrix is not fitted, because needed as starting hyperSD.</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>The function name holding the model describing y's relationship
to all the x's, without quote marks. The first argument of the function
must be named x, the second param, with additional arguments allowed. The
model may accept as x either a vector or a matrix, the latter for a
multiple regression. There can be any number of parameters, but the number
must match the number given as start parameters. The return value must be a
numeric vector with the same size as x.</p></td>
    </tr>
    <tr>
      <th>error</th>
      <td><p>A character variable with 6 possible values: "Binom", "NgBinom",
"Pois", "Gauss", "GaussMultResid", or "Flat".</p><ul>
<li><p>"Binom" uses binomial error for residuals - NegBinom'uses negative
binomial error for residuals; the SD is then the dispersion parameter (k)
of the negative binomial.</p></li>
<li><p>"Poisson" uses Poisson error for residuals.</p></li>
<li><p>"Gauss" uses Gaussian error for residuals with constant standard
deviation across groups.</p></li>
<li><p>"GaussMultResid" uses Gaussian error for residuals, with standard
deviation a constant fraction of the model's prediction (and thus only
appropriate if predictions are strictly positive).</p></li>
<li><p>"Flat" is a trivial model where the same likelihood is returned
regardless of parameters or data. It is for testing how parameter search
behaves in absence of data, as for describing an implied prior.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>includeCovar</th>
      <td><p>TRUE or FALSE, whether to fit the full covariance matrix,
vs. variances alone.</p></td>
    </tr>
    <tr>
      <th>update</th>
      <td><p>'conjugate' or 'metropolis', whether to use inverse-gamma (or
inverse-Wishart for full covariance) vs. metropolis steps for updating
covariances.</p></td>
    </tr>
    <tr>
      <th>badparam</th>
      <td><p>The name of a function (unquoted) that tests a set of model
parameters for validity; must return TRUE if parameters are valid,
otherwise FALSE.</p></td>
    </tr>
    <tr>
      <th>sdfunc</th>
      <td><p>The name of a function (unquoted) that models the residual
standard deviation as a function of the x's, just like the model function.
The default uses the function named constant, meaning the standard
deviation is the same for all values of x. Parameters for this function are
estimated, just as parameters for the model function are.</p></td>
    </tr>
    <tr>
      <th>badSDparam</th>
      <td><p>The name of a function which tests for invalid parameters
for sdfunc, returning TRUE or FALSE (analogous to badparam); a simple
version is provided, called badSD, which rejects a single parameter if it
is &lt; 0.</p></td>
    </tr>
    <tr>
      <th>paramfile</th>
      <td><p>The name of a file where the entire MCMC chain of parameter
values is stored at regular intervals; when parameters are written to the
file, they are erased from memory, thus removing the need for the entire
chain of all parameters being stored at once while the model is running.</p></td>
    </tr>
    <tr>
      <th>savestep</th>
      <td><p>Parameters are appended to paramfile every savestep steps;
must be &lt; steps.</p></td>
    </tr>
    <tr>
      <th>steps</th>
      <td><p>The number of steps to run the Gibbs sampler.</p></td>
    </tr>
    <tr>
      <th>showstep</th>
      <td><p>Information is printed to the screen every showstep steps.</p></td>
    </tr>
    <tr>
      <th>burnin</th>
      <td><p>The number of steps to remove as burn-in before calculating
posterior distributions; not that all parameters are saved and returned
regardless.</p></td>
    </tr>
    <tr>
      <th>debug</th>
      <td><p>Logical. If TRUE, call browser to debug.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>The typical R means for submitting additional parameters for
various functions used in the model (<code>model</code>, <code>sdfunc</code>, <code>badparam</code>,
<code>badSDparam</code>).</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with several components:</p><ul>
<li><p>mu: A 2D array with the entire chain of model parameters (ie, fixed
effects) from the Gibbs sampler</p></li>
<li><p>sigma: A 3D array with the entire chain of covariances from the Gibbs
sampler; if includeCovar==FALSE, only the diagonal is non-zero</p></li>
<li><p>bestmu: Best estimate of the model parameters for the entire data (ie,
fixed effect)</p></li>
<li><p>bestsigma: Best estimate of the covariance (ie, group-level variance or
error)</p></li>
<li><p>resid: The entire chain parameters for the model of residuals</p></li>
<li><p>bestresid: The best estimate of parameters for the model of residuals</p></li>
<li><p>CIresid: Credible intervals for the parameters for the model of residuals</p></li>
<li><p>best: The best estimates of model parameters for each random effect</p></li>
<li><p>lower: Lower credible intervals of model parameters for each random effect</p></li>
<li><p>upper: Uower credible intervals of model parameters for each random effect</p></li>
<li><p>burn: The burn-in</p></li>
<li><p>llike: Full log-likelihood of the model at each step of the Gibbs'sampler</p></li>
<li><p>bestlike: The log-likelihood of the optimal parameter combination (means
of the posterior distribution)</p></li>
<li><p>DIC: Deviance information criterion of the model</p></li>
<li><p>obs: The original y (dependent) variable, just as submitted</p></li>
<li><p>data: The original x (independent) variables, just as submitted</p></li>
<li><p>model: The model's predictions, as a list with one element per random
effect</p></li>
<li><p>randlike: The log-likelihood of observations for each random effect given
the optimal parameters (a vector, one per random effect)</p></li>
<li><p>keep: The steps of the Gibbs sampler after burn-in, as a vector of
negative numbers</p></li>
<li><p>start: The start parameters submitted</p></li>
<li><p>randeffects: The names of all the random effects</p></li>
<li><p>parnames: The names of the model parameters</p></li>
<li><p>fullparam: A 3D array with all parameters of the Gibbs sampler; one
dimension if for all the random effects, with each random effect having a
matrix of model parameters for every step of the Gibbs's sampler</p></li>
</ul>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Data are submitted the way lm or lmer require, with one single table, one row
per observation; the random effects are in one column. The formula, however,
is not submitted using the R-style 'squiggle'~. Rather, the names of x, y,
and random columns, are given. The model describing y's function of the x's
is passed, and must be provided by the user (several are available within the
CTFS R Package, though, in the Utilities topic). Examples below will serve to
explain.</p>
<p>As in lmer, all parameters of the model follow a Gaussian hyperdistribution
across the random effects. There is an option to include a full covariance
matrix as the hyperdistribution, otherwise, only the variances are fit (ie,
the covariance matrix has only zeroes off-diagonal). There is also an option
to use the conjugate inverse-gamma or inverse-wishart for the variances and
covariances; otherwise, Metropolis steps are used.</p>
<p>A starting set of parameters for the model must be submitted. It can be a
vector as long as the number of parameters required by the model, or it can
be a full matrix, with one row of parameters for each of the random effects.
The latter requires knowing in advance the names of all the random effects.</p>
<p>There is a further complication included whose purpose is reducing memory
demand in big models with many MCMC steps. option paramfile allows the full
parameter matrix to be written into a text file every savestep steps, then
erased from memory.</p>
<p>This is to reduce memory needs. The function summaryMCMC restores the
parameters from the text file into an giant R array.</p>
<p>Further details are given in the description of all the arguments and the
sample here, plus a tutorial on <a href='https://goo.gl/KGJYQe'>Mortality changes</a>
offers a worked example.</p>
    
    <h2 class="hasAnchor" id="arguments-description"><a class="anchor" href="#arguments-description"></a>Arguments description</h2>

    
    <ul>
<li><p><code>start</code> Apart from a vector, it can be a matrix of such vectors, one per
random effect.</p></li>
</ul>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'># Assume two plot datasets from BCI are available, bciex::bci12t6mini and</span>
<span class='kw pkg'>bciex</span><span class='kw ns'>::</span><span class='no'>bci12t7mini.</span>
<span class='co'># Subset to trees above 10 cm dbh and just 10 species for illustration (the</span>
<span class='co'># model will run much faster). The fixed effect, species - level variation</span>
<span class='co'># (or error), and the model parameters for each species are shown below. </span>
<span class='co'># Check the names of the result to see what else lmerBayes returns.</span>

<span class='no'>gtable</span> <span class='kw'>=</span> <span class='fu'><a href='growth.indiv.html'>growth.indiv</a></span>(<span class='kw pkg'>bciex</span><span class='kw ns'>::</span><span class='no'><a href='http://www.rdocumentation.org/packages/bciex/topics/bciYYtNmini'>bci12t6mini</a></span>, <span class='kw pkg'>bciex</span><span class='kw ns'>::</span><span class='no'><a href='http://www.rdocumentation.org/packages/bciex/topics/bciYYtNmini'>bci12t7mini</a></span>, <span class='kw'>mindbh</span> <span class='kw'>=</span> <span class='fl'>100</span>)
<span class='no'>a_few_species</span> <span class='kw'>=</span> <span class='fu'>c</span>(
  <span class='st'>'termam'</span>,
  <span class='st'>'tachve'</span>,
  <span class='st'>'pri2co'</span>,
  <span class='st'>'gustsu'</span>,
  <span class='st'>'cecrin'</span>,
  <span class='st'>'tet2pa'</span>,
  <span class='st'>'guatdu'</span>,
  <span class='st'>'vochfe'</span>,
  <span class='st'>'virose'</span>,
  <span class='st'>'maquco'</span>
)
<span class='no'>gtable</span> <span class='kw'>=</span> <span class='fu'>subset</span>(<span class='no'>gtable</span>, !<span class='fu'>is.na</span>(<span class='no'>incgr</span>) <span class='kw'>&amp;</span> <span class='no'>sp</span> <span class='kw'>%in%</span> <span class='no'>a_few_species</span>)
<span class='no'>mod</span> <span class='kw'>=</span> <span class='fu'>lmerBayes</span>(
  <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>gtable</span>,
  <span class='kw'>ycol</span> <span class='kw'>=</span> <span class='st'>'incgr'</span>,
  <span class='kw'>xcol</span> <span class='kw'>=</span> <span class='st'>'dbh1'</span>,
  <span class='kw'>randcol</span> <span class='kw'>=</span> <span class='st'>'sp'</span>,
  <span class='kw'>start</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1</span>, <span class='fl'>0</span>),
  <span class='kw'>startSD</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>startCov</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>linear.model</span>,
  <span class='kw'>error</span> <span class='kw'>=</span> <span class='st'>'Gauss'</span>,
  <span class='kw'>includeCovar</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>badSDparam</span> <span class='kw'>=</span> <span class='no'>badSD</span>,
  <span class='kw'>steps</span> <span class='kw'>=</span> <span class='fl'>1100</span>,
  <span class='kw'>showstep</span> <span class='kw'>=</span> <span class='fl'>50</span>,
  <span class='kw'>burnin</span> <span class='kw'>=</span> <span class='fl'>100</span>
)
<span class='no'>mod</span>$<span class='no'>bestmu</span>
<span class='fu'>diag</span>(<span class='fu'>sqrt</span>(<span class='no'>mod</span>$<span class='no'>bestsigma</span>))
<span class='no'>mod</span>$<span class='no'>best</span>
<span class='fu'>names</span>(<span class='no'>mod</span>)
<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#arguments-description">Arguments description</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Rick Condit, Pamela Hall, Suzanne Lao.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
