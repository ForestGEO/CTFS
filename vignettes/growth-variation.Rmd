---
title: "Growth variation through time"
subtitle: "Adapted by Mauro Lepore from the original tutorial by Richard Condit (https://goo.gl/c9RjMY)"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{"growth variation through time"}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = TRUE
)
```

# Conventions to refer to code

I refer to code following the conventions of [R for data science](http://r4ds.had.co.nz/introduction.html), by Hadley Wickham & Garrett Grolemund:

> Functions are in a code font and followed by parentheses, like `sum()`, or `mean()`.

> Other R objects (like data or function arguments) are in a code font, without parentheses, like `flights` or `x`.

> If we want to make it clear what package an object comes from, we’ll use the package name followed by two colons, like` dplyr::mutate()`, or `nycflights13::flights`. This is also valid R code.

# Hypotheses

The question addressed here is how growth has changed with time, in particular how species differ in growth changes. There are two alternative models described:

* Growth rate changing linearly with time
* Growth rate varying from census to census, but not following a consistent change

# Packages

The functions we use here come with the [ctfs](https://forestgeo.github.io/ctfs/) and [lme4](https://github.com/lme4/lme4/) packages, and the data comes in the [bci](https://forestgeo.github.io/bci/) package:

```{r, message=FALSE}
# installation instructions at https://github.com/forestgeo/ctfs
library(ctfs)
# installation instructions at https://github.com/lme4/lme4/
library(lme4)
# installation instructions at https://forestgeo.github.io/bci/
library(bci)
```


To access functions commonly used for data analysis, load the tidyverse package:

```{r, message=FALSE}
# install.packages("tidyverse")
library(tidyverse)
```


# Formatting data

First, let's table the growth rate of every tree in every census interval.

To calculate growth rates for individual trees and table them in the format lmer understands, we use `ctfs::individual_grow.table()`. `individual_grow.table()` collects results from several other functions.






xxxcont. Use data from several censuses in bci with library(bci) instead of the chunk below

```{r xxxLoadData, include=FALSE}
census_rda <- c("bci12full1.rda", "bci12full5.rda", "bci12full7.rda")
map2("../bci/data/", census_rda, paste0) %>%
  walk(load, .GlobalEnv)
```







```{r, eval=FALSE}
# See defaults and variables definition with ?individual_grow.table

# Choose censuses you wish to work with
census_lst <- list(bci12full1, bci12full5, bci12full7)
# Choose tree diameter between mindbh and maxdbh (here using big trees)
grate <- individual_grow.table(census_lst, mindbh = 400, maxdbh = 10000)

head(grate)
```

VALUES

`individual_grow.table` outputs a data frame where each row gives data from one individual, including:

- `tag`: the tree’s tag number;
- `gx`, `gy`: coordinates;
- `species`: species;
- `dbh1`, `dbh2`: tree diameter at census 1 and 2
- `census`, `censusfact`: census interval; 1 means growth between census 1 and 2, and 2 means growth from census 2 to 3, etc. `census` and `censusfact` store the same information but they differ in that their values are integers and factors.
- `time`: mid-point of the interval over which growth was measured, centered on 1992. This is the format needed by lmer. The reason for centering time is that it is much better in linear regressions to have the x-axis near zero.
- `LnSize`: log(dbh1);
- `incgr`: untransformed growth increment; growth increment (difference in dbh) per year;
- `LnGrowth`: log of the growth rate, with negatives and zeroes converted to 0.1 (from the argument mingrowth in the function);
- `CRGrowth`: cube root of growth rate; power transformation of the growth rate, with negatives maintained negative (exponent = 0.45). Althouth you may use `incgr`or `LnGrowth`, `CRGrowth` allows cleaner analyses, that need no assumption about negative growths.
















xxxcont



# References

[Repository](https://dx.doi.org/10.5479/data.bci.20130603) of the Barro Colorado Forest Census Plot Data (version 2012).

[Description](https://repository.si.edu/bitstream/handle/10088/20925/RoutputFull.pdf?sequence=1&isAllowed=y) of the Barro Colorado Forest Census Plot Data.

# Todo

MOST IMPORTANT

- Use data from several censuses in bci
- Document missing arguments in `individual_grow.table()`
- Document variable names of output in `individual_grow.table()`

LESS IMPORTANT

- track functions called by `individual_grow.table()`
